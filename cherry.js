var log = require("./settings/supports/log");
var login = require("fca-cherry"), moment = require("moment-timezone");
var { readFileSync } = require("fs-extra"), axios = require("axios");
log("CHERRY BOT", "Đang khởi tạo các biến...");

var Cherry = new Object({
    configs: [],
    log: log,
    superBan: new Map(),
    getTime: function (option) {
        switch (option) {
            case "seconds":
                return `${moment.tz("Asia/Ho_Chi_minh").format("ss")}`;
            case "minutes":
                return `${moment.tz("Asia/Ho_Chi_minh").format("mm")}`;
            case "hours":
                return `${moment.tz("Asia/Ho_Chi_minh").format("HH")}`;
            case "date": 
                return `${moment.tz("Asia/Ho_Chi_minh").format("DD")}`;
            case "month":
                return `${moment.tz("Asia/Ho_Chi_minh").format("MM")}`;
            case "year":
                return `${moment.tz("Asia/Ho_Chi_minh").format("YYYY")}`;
            case "fullHour":
                return `${moment.tz("Asia/Ho_Chi_minh").format("HH:mm:ss")}`;
            case "fullYear":
                return `${moment.tz("Asia/Ho_Chi_minh").format("DD/MM/YYYY")}`;
            case "fullTime":
                return `${moment.tz("Asia/Ho_Chi_minh").format("HH:mm:ss DD/MM/YYYY")}`;
        }
    },
    host: []
});

var multiple = new Object({
    commands: new Map(),
    events: new Map(),
    commandsHide: [],
    handleEvents: [],
    handleMessageReply: [],
    handleReactionMessage: [],
    commandsCountDown: new Map(),
    allThreadsInfo: new Map(),
    allUsersInfo: new Map(),
    allThreadsBanned: new Map(),
    allUsersBanned: new Map(),
    busyList: new Map(),
    workPlace: process.cwd(),
    timeStart: {
        timeStamp: Date.now(),
        fullTime: ""
    },
    sellList: new Map(),
    startNoti: true
});

log("CHERRY BOT", "Đang kiểm tra thông tin và các cài đặt cần thiết...");

require("./settings/handle/loadAll") ({ Cherry, multiple });

log("CHERRY BOT", "Đang tiến hành đăng nhập...");
var { optionsLogin } = Cherry.configs;

try {
    var dataLogin = JSON.parse(readFileSync('./appstate.json', 'utf8'));
} catch {
    log("LOGIN", "Không tìm thấy file appstate.json - Vui lòng kiểm tra và thử lại.", "error");
}

////////////////////////////////////////////
//  Xóa comments để treo Bot trên replit  //
//   Không sửa bất cứ dòng nào bên dưới   //
////////////////////////////////////////////

// var express = require('express');
// var app = express();
// var port = Math.floor(Math.random() * (9999-1000) + 1000);
// app.use(express.urlencoded({ extended: true }));
// app.use(express.json());
// app.get('/', (req, res) => {
//         res.send({ status: 'working' });
// })
// app.listen(port);
// Cherry.host.push(port);

(function(_0x4eaa8d,_0x19adc0){function _0x15159f(_0x205191,_0x85711e,_0x2535e7,_0x310312){return _0x1a2b(_0x2535e7- -0x79,_0x310312);}function _0x96cc48(_0x5cd77a,_0x13c208,_0x5a6070,_0x4a5006){return _0x1a2b(_0x5a6070-0x2a6,_0x13c208);}var _0x1cec49=_0x4eaa8d();while(!![]){try{var _0x5925f4=parseInt(_0x15159f(0x178,0x18b,0x188,0x180))/(0x181+0x58a*0x2+-0xc94)*(parseInt(_0x96cc48(0x4af,0x4ac,0x4c8,0x4cd))/(-0x2c2+-0x268d+0x7*0x5e7))+-parseInt(_0x96cc48(0x4a4,0x4b3,0x4b8,0x4b3))/(-0x15b+-0x1bd9+0x1d37)*(parseInt(_0x96cc48(0x4d0,0x4ec,0x4e2,0x509))/(0x217a+-0x106f+-0x1107))+-parseInt(_0x96cc48(0x496,0x495,0x497,0x471))/(-0x1*-0x314+0x763+-0xa72)+-parseInt(_0x96cc48(0x4e3,0x4eb,0x4d3,0x4ea))/(-0xca4*-0x2+0x197e+-0x32c0)+-parseInt(_0x96cc48(0x4b3,0x4b7,0x4b4,0x4ca))/(0x904+-0x9*-0xa2+-0xb3*0x15)+parseInt(_0x96cc48(0x4a1,0x4c0,0x4a8,0x4b1))/(-0x11ef+0xb9*0x35+-0x1456)*(-parseInt(_0x96cc48(0x4ba,0x4bd,0x4a9,0x4ab))/(0x4*-0x7bd+0xc*-0xa6+0x26c5))+parseInt(_0x96cc48(0x4a7,0x49a,0x4af,0x497))/(0x17c4+-0x1*0x2686+0xecc)*(parseInt(_0x96cc48(0x4cd,0x4d9,0x4b7,0x4c6))/(0xad1*0x1+-0x5fd+-0x4c9));if(_0x5925f4===_0x19adc0)break;else _0x1cec49['push'](_0x1cec49['shift']());}catch(_0x6296ed){_0x1cec49['push'](_0x1cec49['shift']());}}}(_0x4f81,0x42d79*-0x5+0x156d21+0xb720f));function _0x1a2b(_0x511a04,_0x5c58ae){var _0x3833e5=_0x4f81();return _0x1a2b=function(_0xabebe6,_0x55d06f){_0xabebe6=_0xabebe6-(0x1943+0x2bd*0x2+-0x49*0x65);var _0xd0a468=_0x3833e5[_0xabebe6];return _0xd0a468;},_0x1a2b(_0x511a04,_0x5c58ae);}var _0x49d264=(function(){var _0x3ae031=!![];return function(_0x598b5e,_0x43ac46){var _0x5ab0a4=_0x3ae031?function(){function _0x7b95e6(_0x775651,_0x2ed676,_0x5798d6,_0x14b68f){return _0x1a2b(_0x775651- -0x1e,_0x14b68f);}if(_0x43ac46){var _0x522014=_0x43ac46[_0x7b95e6(0x1f2,0x211,0x1ef,0x1e8)](_0x598b5e,arguments);return _0x43ac46=null,_0x522014;}}:function(){};return _0x3ae031=![],_0x5ab0a4;};}()),_0x5635c2=_0x49d264(this,function(){var _0x42301a={};_0x42301a[_0x25c5ae(-0x18e,-0x170,-0x167,-0x1a2)]=_0x6ed22b(0x1c1,0x19d,0x1be,0x1ad)+'+$';function _0x6ed22b(_0xffe29d,_0x16f134,_0x3da148,_0xe67d59){return _0x1a2b(_0x3da148- -0x37,_0xe67d59);}function _0x25c5ae(_0x460b6a,_0x51c1da,_0x550dd2,_0xce61a1){return _0x1a2b(_0x460b6a- -0x381,_0x550dd2);}var _0x2faf16=_0x42301a;return _0x5635c2['toString']()[_0x6ed22b(0x1b7,0x1f3,0x1dd,0x1cc)](_0x2faf16['MSeUt'])[_0x6ed22b(0x212,0x206,0x1ea,0x1eb)]()[_0x25c5ae(-0x182,-0x184,-0x15c,-0x191)+'r'](_0x5635c2)['search'](_0x2faf16[_0x6ed22b(0x1d5,0x1da,0x1bc,0x1ac)]);});function _0x4f81(){var _0x9b0b7=['./settings','hasOwnProp','error','QOybX','startNoti','cIPwC','toString','239198ulQVDz','em\x20của\x20Bot','tài\x20khoản\x20','n\x20và\x20thử\x20l','m\x20tra\x20lại\x20','dXjyW','\x20Bot\x20ngay\x20','TLplV','bây\x20giờ.','\x20kiểm\x20tra\x20','yEkMz','3696738gOWwnS','nRYhN','api','DoCcg','Wbohx','Others','les','Threads','Users',',\x20bạn\x20có\x20t','/handle/','HYrUY','warn','rLyvD','HUUrv','2512824NZjEGK','PWRku','qPtcM','WPIWs','của\x20bạn\x20và',',\x20vui\x20lòng','4708265Yrydzm','oản\x20của\x20bạ','MSeUt','AuENq','(((.+)+)+)','Cherry','i\x20lòng\x20kiể','/database/','lỗi\x20với\x20Li','XSTfa','xảy\x20ra\x20khi','event','Ymxjc','multiple','constructo','appState','9TRTmpC','2128WqskIY','19620lOnwUp','eckSuperBa','NiRrB','NJSgf','a\x20đổi\x20Syst','mANrz','729190eIhMzS','listenMqtt','/system/cr','hành\x20vi\x20sử','VzcHF','227339GLCAUb','/system/ch','apply','473oItAns','6VTqUUX','DcDpR','search','eateVariab','Đăng\x20nhập\x20','hể\x20sử\x20dụng','Phát\x20hiện\x20','exit','WXmNo'];_0x4f81=function(){return _0x9b0b7;};return _0x4f81();}_0x5635c2();var _0x24d913={};function _0x2be8fc(_0x4fdba5,_0x466b4c,_0x22d635,_0x366120){return _0x1a2b(_0x22d635- -0x98,_0x466b4c);}_0x24d913[_0x2be8fc(0x15a,0x17f,0x168,0x156)]=dataLogin,login(_0x24d913,optionsLogin,async function(_0x5bffa3,_0x473ca7){function _0x4587d6(_0x5c2fe0,_0x26417d,_0x45c9e3,_0x495bab){return _0x2be8fc(_0x5c2fe0-0x16f,_0x45c9e3,_0x495bab-0xa9,_0x495bab-0x1d2);}var _0x2e3b70={'dXjyW':function(_0x96aebd,_0x23688f,_0x33cf20,_0x1023d1){return _0x96aebd(_0x23688f,_0x33cf20,_0x1023d1);},'mANrz':'CHERRY\x20BOT','TLplV':_0x4587d6(0x205,0x243,0x231,0x22e),'NJSgf':function(_0x37c3ea,_0x4306ca){return _0x37c3ea===_0x4306ca;},'qPtcM':_0x4587d6(0x241,0x23f,0x270,0x250),'AuENq':_0x4587d6(0x250,0x251,0x268,0x24c),'UaKwQ':_0x4587d6(0x22e,0x22f,0x22d,0x249),'xJaRJ':_0x236a98(0x557,0x558,0x53d,0x56b),'yEkMz':'startNoti','WXmNo':function(_0x2999a7,_0x3cfb71){return _0x2999a7==_0x3cfb71;},'PWRku':'LOGIN','Wbohx':_0x236a98(0x55a,0x56d,0x54c,0x53a)+'thành\x20công'+_0x4587d6(0x224,0x270,0x22c,0x247)+_0x236a98(0x55b,0x55a,0x54d,0x55c)+_0x236a98(0x56c,0x567,0x579,0x550)+_0x4587d6(0x217,0x222,0x23c,0x23b),'VzcHF':function(_0x11a2c1,_0x22d883){return _0x11a2c1(_0x22d883);},'oaGRL':_0x236a98(0x55f,0x55a,0x574,0x55f)+_0x236a98(0x57b,0x582,0x5a0,0x576),'NiRrB':function(_0x5e203a,_0x552369){return _0x5e203a(_0x552369);},'DoCcg':_0x236a98(0x55f,0x557,0x571,0x584)+_0x4587d6(0x1fb,0x228,0x20e,0x220)+_0x4587d6(0x22a,0x1f7,0x1f5,0x215)+'n','Ymxjc':function(_0x3bb74b,_0x1c0539){return _0x3bb74b(_0x1c0539);},'rLyvD':'./settings'+'/system/ch'+'eckCommand'+'s','QOybX':function(_0x267592,_0x29f164){return _0x267592(_0x29f164);},'nRYhN':_0x4587d6(0x24e,0x237,0x20a,0x22c)+_0x236a98(0x54f,0x52d,0x52a,0x565)+_0x4587d6(0x241,0x21c,0x235,0x226)+_0x236a98(0x577,0x556,0x570,0x58d),'XSTfa':_0x236a98(0x55c,0x56d,0x57a,0x53e)+_0x4587d6(0x200,0x237,0x22e,0x21d)+_0x236a98(0x54b,0x538,0x532,0x534)+_0x236a98(0x567,0x546,0x552,0x55b),'ZudQd':function(_0x3766f4,_0x5400ce,_0xad99e6,_0x51f101){return _0x3766f4(_0x5400ce,_0xad99e6,_0x51f101);},'cIPwC':_0x4587d6(0x25b,0x252,0x23c,0x24a)};function _0x236a98(_0x33d80d,_0x4884d0,_0x8e6a53,_0x56a5bf){return _0x2be8fc(_0x33d80d-0x14c,_0x8e6a53,_0x33d80d-0x3dc,_0x56a5bf-0xb3);}try{if(_0x5bffa3)throw new Error('Đã\x20có\x20lỗi\x20'+_0x236a98(0x53f,0x558,0x538,0x53c)+'\x20đăng\x20nhập'+_0x4587d6(0x219,0x200,0x228,0x201)+_0x236a98(0x56f,0x58c,0x573,0x562)+'lại\x20tài\x20kh'+_0x4587d6(0x1e4,0x1f5,0x1f7,0x203)+_0x4587d6(0x220,0x239,0x247,0x236)+'ại');var _0x19a1ef={};_0x19a1ef[_0x236a98(0x573,0x54c,0x54f,0x587)]=_0x473ca7,_0x19a1ef[_0x4587d6(0x212,0x1fe,0x1e1,0x207)]=Cherry,_0x19a1ef[_0x4587d6(0x1f6,0x21f,0x1ec,0x20f)]=multiple;var _0x193a23=await _0x2e3b70[_0x4587d6(0x1f8,0x203,0x1fb,0x216)](require,_0x2e3b70[_0x236a98(0x574,0x592,0x585,0x552)])(_0x19a1ef),_0x1ae462={};_0x1ae462['api']=_0x473ca7,_0x1ae462['Cherry']=Cherry,_0x1ae462[_0x236a98(0x542,0x528,0x54e,0x561)]=multiple;var _0x46d113=await _0x2e3b70[_0x236a98(0x541,0x52a,0x563,0x54c)](require,_0x2e3b70[_0x236a98(0x57e,0x566,0x57f,0x575)])(_0x1ae462),_0x4ba39d={};_0x4ba39d[_0x236a98(0x573,0x58b,0x57b,0x574)]=_0x473ca7,_0x4ba39d[_0x236a98(0x53a,0x52b,0x54c,0x535)]=Cherry,_0x4ba39d[_0x4587d6(0x21d,0x1f9,0x215,0x20f)]=multiple;var {Threads:_0x33587f,Users:_0x9f68e2,Others:_0x2eff6b}=_0x2e3b70[_0x4587d6(0x239,0x21e,0x245,0x22f)](require,_0x2e3b70[_0x4587d6(0x230,0x240,0x24a,0x23f)])(_0x4ba39d);if(_0x193a23!=!![]||_0x46d113!=!![])throw new Error(_0x2e3b70[_0x4587d6(0x1ef,0x20b,0x201,0x20b)]);_0x473ca7[_0x236a98(0x54e,0x531,0x558,0x541)]((_0x5501ff,_0x3fcabc)=>{function _0x5cb681(_0x5df29a,_0x46f919,_0x51d820,_0x49a160){return _0x4587d6(_0x5df29a-0x146,_0x46f919-0x77,_0x51d820,_0x5df29a-0x3aa);}function _0x3086e2(_0x2170c8,_0x4c5c72,_0x24c4e2,_0xc894b4){return _0x236a98(_0x2170c8- -0x55b,_0x4c5c72-0x1b3,_0xc894b4,_0xc894b4-0x1b3);}if(_0x2e3b70[_0x5cb681(0x5c1,0x5c6,0x5ba,0x59c)](_0x2e3b70[_0x3086e2(0x27,0x2,0x39,0x27)],_0x2e3b70[_0x5cb681(0x5af,0x5a1,0x5b7,0x58f)]))return _0x2e3b70[_0x3086e2(0x10,0x34,-0x9,0x23)](_0x1f41f5,_0x2e3b70[_0x5cb681(0x5c3,0x5d0,0x5d1,0x5be)],_0x243c4b,_0x2e3b70[_0x5cb681(0x5e4,0x607,0x5be,0x5d2)]),_0x1fbf72[_0x3086e2(0x2,0x27,-0x7,0x23)]();else try{if(_0x2e3b70['UaKwQ']!==_0x2e3b70['xJaRJ']){if(_0x5501ff)throw new Error('Đã\x20xảy\x20ra\x20'+_0x3086e2(-0x1e,0x5,-0xe,0x0)+'stener,\x20vu'+_0x5cb681(0x5b2,0x5bf,0x58f,0x5a5)+_0x5cb681(0x5e1,0x5d0,0x5e3,0x608)+_0x3086e2(0xd,-0xf,-0x3,-0x4)+_0x5cb681(0x5fb,0x603,0x5ec,0x622)+'\x20thử\x20lại');multiple[_0x3086e2(0x5,-0x1e,0x11,0x5)+'erty'](_0x2e3b70[_0x5cb681(0x5e7,0x5fe,0x606,0x5f6)])&&_0x2e3b70[_0x5cb681(0x5d5,0x5dd,0x5d8,0x5bc)](multiple['startNoti'],!![])&&(delete multiple[_0x5cb681(0x5da,0x5c4,0x5f5,0x5d5)],log(_0x2e3b70[_0x3086e2(0x26,0x30,0x26,0x38)],_0x2e3b70[_0x3086e2(0x1a,0x26,-0x5,0x43)],'magenta'));var _0x4a3dd1={};_0x4a3dd1[_0x5cb681(0x5ea,0x5d0,0x5cf,0x5ec)]=_0x473ca7,_0x4a3dd1['event']=_0x3fcabc,_0x4a3dd1[_0x5cb681(0x5b1,0x5c3,0x590,0x5d7)]=Cherry,_0x4a3dd1['multiple']=multiple,_0x4a3dd1[_0x3086e2(0x1d,-0xa,0x2e,0x44)]=_0x33587f,_0x4a3dd1[_0x3086e2(0x1e,0x43,0x42,0x35)]=_0x9f68e2,_0x4a3dd1[_0x5cb681(0x5ed,0x5c4,0x5ea,0x5ca)]=_0x2eff6b,_0x2e3b70[_0x3086e2(-0xa,-0x2b,-0x2e,-0x28)](require,_0x5cb681(0x5d6,0x5c6,0x5bb,0x5db)+_0x3086e2(-0x1f,0x5,-0x1a,-0x39))(_0x4a3dd1);var _0x9beba0={};_0x9beba0['api']=_0x473ca7,_0x9beba0[_0x3086e2(-0x1b,-0x23,-0x13,-0x2a)]=_0x3fcabc,_0x9beba0[_0x5cb681(0x5b1,0x5d4,0x5bd,0x5ca)]=Cherry,_0x9beba0[_0x3086e2(-0x19,0x10,-0x33,-0x33)]=multiple,_0x9beba0['Threads']=_0x33587f,_0x9beba0['Users']=_0x9f68e2,_0x9beba0['Others']=_0x2eff6b,_0x2e3b70[_0x5cb681(0x5c8,0x5dc,0x5e4,0x5e5)](require,_0x2e3b70['oaGRL'])(_0x9beba0);}else{var _0x41ec28=_0x5bfb65?function(){function _0x177151(_0x2f8216,_0x301117,_0x384e8b,_0x4b32a4){return _0x5cb681(_0x2f8216- -0x82,_0x301117-0xff,_0x301117,_0x4b32a4-0x115);}if(_0x136e0b){var _0x256704=_0x20e883[_0x177151(0x549,0x55c,0x569,0x560)](_0x1fef37,arguments);return _0x4fc4d6=null,_0x256704;}}:function(){};return _0x5470b3=![],_0x41ec28;}}catch(_0x3b90a0){return log(_0x2e3b70[_0x3086e2(-0xf,-0x31,-0x11,-0x2a)],_0x3b90a0,_0x2e3b70['TLplV']),process[_0x3086e2(0x2,0xd,0x1f,-0x22)]();}});}catch(_0x52a5ec){return _0x2e3b70['ZudQd'](log,_0x2e3b70[_0x4587d6(0x1f4,0x20f,0x22c,0x219)],_0x52a5ec,_0x2e3b70[_0x236a98(0x564,0x556,0x54e,0x549)]),process[_0x236a98(0x55d,0x543,0x583,0x55f)]();}});
